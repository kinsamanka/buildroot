From 2bcc083d55f4241fcfba2b50c978045d848a0b5f Mon Sep 17 00:00:00 2001
From: GP Orcullo <kinsamanka@gmail.com>
Date: Tue, 26 Sep 2023 08:22:38 +0800
Subject: [PATCH 1/2] fix for RISC-V ISA updates introduced from 12.x

---
 arch/riscv/Makefile | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/riscv/Makefile b/arch/riscv/Makefile
index 66f62b0366e0..b6ba476ec49c 100644
--- a/arch/riscv/Makefile
+++ b/arch/riscv/Makefile
@@ -43,6 +43,9 @@ riscv-march-cflags-$(CONFIG_ARCH_RV32I)		:= rv32ima
 riscv-march-cflags-$(CONFIG_ARCH_RV64I)		:= rv64ima
 riscv-march-cflags-$(CONFIG_RISCV_ISA_C)	:= $(riscv-march-cflags-y)c
 
+riscv-march-cflags-$(CONFIG_ARCH_RV32I)         := $(riscv-march-cflags-y)_zicsr_zifencei
+riscv-march-cflags-$(CONFIG_ARCH_RV64I)         := $(riscv-march-cflags-y)_zicsr_zifencei
+
 riscv-march-aflags-$(CONFIG_ARCH_RV32I)		:= rv32ima
 riscv-march-aflags-$(CONFIG_ARCH_RV64I)		:= rv64ima
 riscv-march-aflags-$(CONFIG_FPU)		:= $(riscv-march-aflags-y)fd
@@ -51,6 +54,9 @@ riscv-march-aflags-$(CONFIG_VECTOR_1_0)		:= $(riscv-march-aflags-y)v
 riscv-march-aflags-$(CONFIG_VECTOR_0_7)		:= $(riscv-march-aflags-y)v0p7
 riscv-march-aflags-$(CONFIG_RISCV_ISA_THEAD)	:= $(riscv-march-aflags-y)xthead
 
+riscv-march-aflags-$(CONFIG_ARCH_RV32I)         := $(riscv-march-aflags-y)_zicsr_zifencei
+riscv-march-aflags-$(CONFIG_ARCH_RV64I)         := $(riscv-march-aflags-y)_zicsr_zifencei
+
 KBUILD_CFLAGS += -march=$(riscv-march-cflags-y) -Wa,-march=$(riscv-march-aflags-y)
 KBUILD_AFLAGS += -march=$(riscv-march-aflags-y)
 
-- 
2.41.0

